name: CNEMC Realtime Update

on:
  workflow_dispatch:      # 允许手动补跑
  schedule:
    - cron: '40 * * * *'  
permissions:
  contents: write
jobs:
  build-linux:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Inspect runner system
      run: |
        echo "===== OS ====="
        # uname -a
        lsb_release -a || cat /etc/os-release
        echo "===== CPU ====="
        lscpu | grep "Model name" && lscpu | grep "^CPU(s)"
        echo "===== Memory ====="
        free -h
        echo "===== Disk ====="
        df -h
        # echo "===== Disk details ====="
        # lsblk
        echo "===== Current user ====="
        whoami
        echo "===== Working directory ====="
        pwd
        echo "===== Files ====="
        ls -lh
        echo "===== Download speed test (curl) ====="
        curl -L -o /dev/null https://github.com/git/git/archive/refs/tags/v2.44.0.tar.gz
    - name: Install dependencies
      run: |
        pip install requests numpy pandas
    - name: Run Python
      run: |
        python cnemc_whole.py
    - name: Commit changes if any
      run: |
        git config --global user.email "BOT@github.com"
        git config --global user.name "githubBOT"
        git add .
        git diff --cached --quiet || git commit -m "update realtime data" -a
        # git commit -m "update realtime data" -a
    - name: Who am I (git)
      run: |
        git remote -v
        git config --get user.name
        git config --get user.email
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{secrets.GTOKEN}}
